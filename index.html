<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:;">
  <title>Migration Finder</title>

  <style>
    :root {
      --bg-body:       #000000;
      --bg-card:       #1f1f2a;
      --text-main:     #c0c0c8;
      --input-bg:      #2a2a3d;
      --input-border:  #444;
      --input-text:    #e0e0e8;
      --button-bg:     #3a86ff;
      --button-hover:  #559aff;
      --card-radius:   16px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 2rem;
      min-height: 100vh;
      background: var(--bg-body);
      font-family: Roboto, sans-serif;
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .card {
      background: var(--bg-card);
      border-radius: var(--card-radius);
      padding: 2rem;
      width: 360px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.7);
    }
    .card h2 { margin: 0 0 1rem; font-size: 1.5rem; text-align: center; }
    .card label { display: block; margin-top: 1rem; font-size: 0.9rem; }
    .card input {
      width: 100%; padding: 0.5rem; margin-top: 0.25rem;
      background: var(--input-bg); border: 1px solid var(--input-border);
      border-radius: 4px; color: var(--input-text); font-size: 1rem;
    }
    .card button {
      width: 100%; padding: 0.75rem; margin-top: 1.5rem;
      background: var(--button-bg); border: none; border-radius: 8px;
      color: #fff; font-size: 1rem; cursor: pointer;
      transition: background 0.2s;
    }
    .card button:hover { background: var(--button-hover); }

    .results-card {
      display: none; background: var(--bg-card); border-radius: var(--card-radius);
      padding: 1rem; margin: 1.5rem auto; box-shadow: 0 8px 24px rgba(0,0,0,0.7);
      overflow-x: auto; width: 80vw; max-width: 100%;
    }
    .results-card h2 { margin: 0 0 1rem; font-size: 1.25rem; text-align: center; }
    table {
      border-collapse: collapse; table-layout: auto; width: max-content; white-space: nowrap;
    }
    th, td {
      padding: 0.5rem; border-bottom: 1px solid var(--input-border);
      font-size: 0.9rem; white-space: nowrap; text-align: left;
    }
    th { border-bottom: 2px solid var(--input-border); }
    /* Scrollbars */
    .results-card::-webkit-scrollbar { height: 8px; width: 8px; }
    .results-card::-webkit-scrollbar-track { background: transparent; }
    .results-card::-webkit-scrollbar-thumb {
      background-color: #444; border-radius: 4px;
    }
    .results-card::-webkit-scrollbar-thumb:hover { background-color: #666; }
    body::-webkit-scrollbar { width: 8px; }
    body::-webkit-scrollbar-track { background: transparent; }
    body::-webkit-scrollbar-thumb { background-color: #444; border-radius: 4px; }
    body::-webkit-scrollbar-thumb:hover { background-color: #666; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Migration Finder</h2>
    <label for="bac">BAC Code</label>
    <input id="bac" type="number" placeholder="Enter BAC" />
    <label for="dealerName">Account Name</label>
    <input id="dealerName" type="text" placeholder="Enter name" />
    <label for="zip">ZIP Code</label>
    <input id="zip" type="number" placeholder="Enter ZIP" />
    <button id="searchBtn">SEARCH</button>
  </div>

  <div class="results-card" id="resultsCard">
    <h2>Results</h2>
    <table id="resultsTable"></table>
  </div>

  <script>
    // renderer script: invoke OAuth & parsing in main, filter here
    const { ipcRenderer } = require('electron');
    const { searchReport } = require('./report.js');

    const searchBtn    = document.getElementById('searchBtn');
    const resultsCard  = document.getElementById('resultsCard');
    const resultsTable = document.getElementById('resultsTable');

    searchBtn.addEventListener('click', async () => {
      searchBtn.disabled = true;
      try {
        // 1. Download & parse via main process
        const parsed = await ipcRenderer.invoke('fetch-report');

        // 2. Collect criteria
        const criteria = {
          bac:        document.getElementById('bac').value.trim(),
          dealerName: document.getElementById('dealerName').value.trim(),
          zip:        document.getElementById('zip').value.trim(),
        };

        // 3. Filter
        const results = searchReport(parsed, criteria);

        // 4. Render table
        resultsTable.innerHTML = '';
        const headerRow = document.createElement('tr');
        parsed.headers.forEach(h => {
          const th = document.createElement('th');
          th.textContent = h;
          headerRow.appendChild(th);
        });
        resultsTable.appendChild(headerRow);

        results.forEach(row => {
          const tr = document.createElement('tr');
          parsed.headers.forEach(h => {
            const td = document.createElement('td');
            td.textContent = row[h] || '';
            tr.appendChild(td);
          });
          resultsTable.appendChild(tr);
        });

        resultsCard.style.display = results.length ? 'block' : 'none';
        if (!results.length) alert('No matching rows found.');
      } catch (err) {
        console.error(err);
        alert('Search error: ' + err.message);
      } finally {
        searchBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
